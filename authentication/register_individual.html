<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Individual Registration</title>
</head>
<body>
    <h1>Individual Registration</h1>
    <button id="connectWalletBtn">Connect Wallet</button>
    <button id="googleSignInBtn" disabled>Sign in with Google</button>

    <script src="../assets/script_common.js"></script>
    <script src="https://cdn.auth0.com/js/auth0/9.19/auth0.min.js"></script>
    <script src="./config.json"></script> <!-- Load config.json -->
    <script>
      // Load configuration from config.json
      fetch('config.json')
        .then(response => response.json())
        .then(config => {
          var auth0 = new auth0.WebAuth({
              domain: config.AUTH0_DOMAIN,
              clientID: config.AUTH0_CLIENT_ID,
              redirectUri: config.FRONTEND_URL,
              retry: config.RETRY_URL,
              responseType: 'token id_token',
              scope: 'openid profile email'
          });

          var googleSignInBtn = document.getElementById('googleSignInBtn');

          googleSignInBtn.addEventListener('click', function() {
              auth0.authorize({
                  connection: 'google'
              });
          });

          // Check if there are tokens in the URL hash indicating a successful authentication
          var handleAuthentication = function() {
              auth0.parseHash(function(err, authResult) {
                  if (authResult && authResult.accessToken && authResult.idToken) {
                      // Save tokens to local storage or session storage if needed
                      window.location.href = config.FRONTEND_URL;
                  } else if (err) {
                      console.error('Authentication error:', err);
                      window.location.href = config.RETRY_URL;
                  }
              });
          };

          // Call the function to handle authentication when the page loads
          handleAuthentication();
        })
        .catch(error => console.error('Error loading config.json:', error));
  </script>
</body>
</html>
